<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Order Grid Heatmap</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    .grid-label { font-size: 10px; color: #000; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var mapCenter = [28.459, 77.026];
      var map = L.map('map').setView(mapCenter, 14);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap'
      }).addTo(map);

      var orders = [
        { lat: 28.459, lng: 77.026, value: 2 } // sample order
      ];

      orders.forEach(function (o) {
        L.circleMarker([o.lat, o.lng], {
          radius: 4,
          color: 'blue',
          fillColor: 'blue',
          fillOpacity: 1
        }).bindPopup('Value: ' + o.value).addTo(map);
      });

      var gridLayer = L.layerGroup().addTo(map);

      function updateGrid() {
        gridLayer.clearLayers();
        var bounds = map.getBounds();
        var south = bounds.getSouth();
        var north = bounds.getNorth();
        var west = bounds.getWest();
        var east = bounds.getEast();

        var baseLat = (south + north) / 2;
        var latStep = 1 / 111; // ~1km in degrees
        var lonStep = 1 / (111 * Math.cos(baseLat * Math.PI / 180));

        for (var lat = Math.floor(south / latStep) * latStep; lat < north; lat += latStep) {
          var nextLat = lat + latStep;
          for (var lng = Math.floor(west / lonStep) * lonStep; lng < east; lng += lonStep) {
            var nextLng = lng + lonStep;

            var sum = 0;
            orders.forEach(function (o) {
              if (o.lat >= lat && o.lat < nextLat && o.lng >= lng && o.lng < nextLng) {
                sum += o.value;
              }
            });

            var color = 'transparent';
            if (sum > 3) color = 'red';
            else if (sum > 1) color = 'yellow';
            else if (sum > 0) color = 'green';

            var rect = L.rectangle([[lat, lng], [nextLat, nextLng]], {
              color: '#555',
              weight: 1,
              fillColor: color,
              fillOpacity: color === 'transparent' ? 0 : 0.5
            }).addTo(gridLayer);

            if (sum > 0) rect.bindTooltip(String(sum), { className: 'grid-label' });
          }
        }
      }

      map.whenReady(updateGrid);
      map.on('moveend', updateGrid);
    });
  </script>
</body>
</html>
